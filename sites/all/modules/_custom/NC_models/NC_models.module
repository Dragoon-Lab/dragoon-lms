<?php
	function loadNCModels($user_name){
        //prepare content as json
        //preparing private content
        //private content consists of folders which are unshared and models which are private
        //unshared folders exist in lms db, we need to pull out these folders
        $mysqli = new mysqli("localhost", "root", "", "Dragoon-Lms");
        if ($mysqli->connect_errno) {
            printf("Connect failed: %s\n", $mysqli->connect_error);
            exit();
        }
        //private unshared folders

        $query = "select sh_name from shared_folders where sh_owner='$user_name' and !sh_current_status";
        //return $query;
        $q_res = $mysqli->query($query);
        $string = array();
        while($res=$q_res->fetch_object()){
            $f_name = $res->sh_name;
            $group = $f_name."-".$user_name;
            //make a request to the dragoon server to list problems where group = sh_name+"-"+owner_name
             $ret = sendGroup($group);
            $ret = json_decode($ret);
            $temp = array(); $temp['ritesh']=$ret;
            $string["private"][$group]=$ret;
        }

        //original private problems
        $priv_group = $user_name."-private";
        $ret  = sendGroup($priv_group);
        $ret = json_decode($ret);
        foreach($ret as $temp){
            $string["private"][$temp] = $temp;
        }

        //shared folders
        $shared_q = "select m.folder_name as folder_name ,s.sh_owner as sh_owner from shared_members m, shared_folders s where m.member_name='$user_name' and m.folder_name=s.sh_name";
        $sh_q_res = $mysqli->query($shared_q);
        while($res_sh = $sh_q_res->fetch_object()){
            $sh_grp=$res_sh->folder_name."-".$res_sh->sh_owner;
            $ret = sendGroup($sh_grp);
            $ret = json_decode($ret);
            foreach($ret as $temp){
                $string["shared"][$sh_grp][$temp] = $temp;
            }
        }


        return json_encode($string);
    }

    function sendGroup($g){
        $url = 'http://localhost/LaitsV3/www/global.php';
        $data = array('t' => 'reqNonClassProblems', 'g' => $g);

        $options = array(
            'http' => array(
                'header'  => "Content-type: application/x-www-form-urlencoded\r\n",
                'method'  => 'POST',
                'content' => http_build_query($data)
            )
        );
        $context  = stream_context_create($options);
        $result = file_get_contents($url, false, $context);
        if ($result === FALSE) { /* Handle error */
            echo "something failed";
        }
        return $result;

    }